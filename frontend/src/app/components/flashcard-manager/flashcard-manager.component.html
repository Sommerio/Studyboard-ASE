<div class="topPageDiv">
  <div class="row p-2 mb-4">

    <mat-form-field *ngIf="this.viewAll" class="pageTopBarSearchField">
      <mat-placeholder style="color: #FEFFFF">Search decks</mat-placeholder>
      <input matInput style="color: #FEFFFF" title="search" type="search">
      <button aria-label="search" mat-button mat-stroked-button matSuffix style="border-color: #FEFFFF;">
        <mat-icon style="color: #FEFFFF">search</mat-icon>
      </button>
    </mat-form-field>

    <button (click)="this.viewAll=true;this.resetDeckForm();" *ngIf="!this.viewAll" class="pageTopBarButton"
            mat-stroked-button>
      Back to all
    </button>
    <button (click)="this.resetDeckForm()" *ngIf="this.viewAll" class="pageTopBarButton"
            data-target=".create-deck-modal" data-toggle="modal"
            mat-stroked-button>
      Create a deck
    </button>
    <button (click)="this.resetDecks();" class="pageTopBarButton" data-target=".create-flashcard-modal"
            data-toggle="modal"
            mat-stroked-button>
      Create a flashcard
    </button>
  </div>
</div>

<!--Create a deck-->
<div aria-hidden="true" aria-labelledby="Create deck modal" class="modal fade create-deck-modal" role="dialog"
     tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Create a new deck for flashcards</h2>
      </div>
      <div class="modal-body">
        <form class="modal-input-form">

          <mat-form-field [formGroup]="deckForm" appearance="outline" class="modal-input-full-width">
            <mat-label class="modal-label">Deck Title</mat-label>
            <input formControlName="title" formGroupName="title"
                   id="deckTitle" matInput
                   placeholder="eg. Math" required type="text">
            <mat-hint *ngIf="deckForm.controls.title.errors" class="control-label invalid-input-text">
              Can't be empty!
            </mat-hint>
          </mat-form-field>
        </form>
      </div>
      <div class="modal-footer">
        <button (click)="createDeck()" [disabled]="deckForm.controls.title.errors" data-dismiss="modal" mat-button
                mat-dialog-actions type="button">
          Save
        </button>
        <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!--Create a flashcard-->
<div aria-hidden="true" aria-labelledby="Create flashcard modal" class="modal fade create-flashcard-modal"
     role="dialog"
     tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Create a new flashcard</h2>
      </div>
      <div class="modal-body flashcardModalBody">
        <form class="modal-input-form">

          <!-- Question -->
          <mat-form-field [formGroup]="flashcardForm" appearance="outline" class="modal-input-full-width">
            <mat-label class="modal-label">Question</mat-label>
            <input formControlName="question" formGroupName="question"
                   id="question" matInput
                   placeholder="Your question" required type="text">
            <mat-hint *ngIf="flashcardForm.controls.question.errors" class="control-label invalid-input-text">
              Can't be empty!
            </mat-hint>
          </mat-form-field>
          <!-- Answer -->
          <mat-form-field [formGroup]="flashcardForm" appearance="outline" class="modal-input-full-width">
            <mat-label class="modal-label">Answer</mat-label>
            <textarea formControlName="answer" formGroupName="answer"
                      id="answer" matInput
                      placeholder="Your answer" required title="Answer"></textarea>
            <mat-hint *ngIf="flashcardForm.controls.answer.errors" class="control-label invalid-input-text">
              Can't be empty!
            </mat-hint>
          </mat-form-field>
          <!--Select deck-->
          <mat-form-field appearance="outline" class="mat-select">
            <mat-label>Select a deck</mat-label>
            <mat-select [(value)]="this.selectedDecksIds" class="select" multiple>
              <mat-option (onSelectionChange)="updateDeckList($event.source.value)" *ngFor="let deck of getDecks()"
                          value="{{deck.id}}">
                {{deck.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </form>
      </div>
      <div class="modal-footer">
        <button (click)="createFlashcard()"
                [disabled]="flashcardForm.controls.question.errors || flashcardForm.controls.answer.errors"
                data-dismiss="modal" mat-button mat-dialog-actions type="button">
          Save
        </button>
        <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<div class="container" style="padding-top: 10px;">
  <!-- View all decks -->
  <div *ngIf="viewAll; else elseBlockDetails">
    <div class="row" id="allDiv">

      <div *ngFor="let deck of getDecks()" class="col-xl-3 col-4 p-2">

        <div class="card">

          <div class="card-body">
            <h3 class="card-title wrapper txt-clr-dark">{{deck.name}}</h3>
            <p class="card-text wrapper txt-clr-dark">Size: {{deck.size}}</p>
            <div class="wrapper"><img src="../../../assets/deck.png" width="90%;"></div>
            <div class="wrapper">
              <button (click)=" this.viewAll=false; loadFlashcards(deck);" class="btn btn-middle"
                      mat-button>
                Details
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--View details of a deck-->
  <ng-template #elseBlockDetails>
    <div id="deck-info">
      <div class="flex-container-space-between">
        <h2 class="txt-clr-dark">Deck {{this.selectedDeck.name}}</h2>
        <div id="deck-buttons">
        <span class="close" data-target=".delete-deck-modal" data-toggle="modal" matTooltip="Delete deck">
          <mat-icon>delete</mat-icon>
        </span>
          <span class="close" data-target=".edit-deck-modal" data-toggle="modal" matTooltip="Edit deck">
          <mat-icon>edit</mat-icon>
        </span>
          <span (click)="this.sizeError=false; this.resetRevisionSizeForm();" class="close"
                data-target=".revise-deck" data-toggle="modal" matTooltip="Revise flashcards">
          <mat-icon>repeat</mat-icon>
        </span>
        </div>
      </div>
      <mat-card>
        <h5>Created: {{this.selectedDeck.creationDate}}</h5>
        <h5>Last revision: {{this.selectedDeck.lastTimeUsed.substring(0, 10)}}</h5>
      </mat-card>
    </div>
    <h3 id="flashcard-title">Flashcards:</h3>
    <div class="row" style="margin-left:-4%;">
      <div *ngFor="let flashcard of getFlashcards()" class="col-xl-3 col-4 p-2">
        <mat-accordion>
          <mat-expansion-panel (closed)="this.showAnswer = false" (opened)="this.showAnswer = true" class="flashcard"
                               style="justify-content:center">
            <mat-expansion-panel-header>
              <h4> Q: {{flashcard.question}}</h4>
            </mat-expansion-panel-header>
            <h4>A: {{flashcard.answer}}</h4>
          </mat-expansion-panel>
        </mat-accordion>
        <div class="flex-container-space-between" style="background-color:#ffffff">
          <span (click)="flashcardClicked(flashcard, false)" class="close" data-target=".rate-flashcard-modal"
                data-toggle="modal" matTooltip="Rate flashcard">
            <mat-icon>grade</mat-icon>
          </span>
          <span (click)="flashcardClicked(flashcard, false)" class="close" data-target=".edit-flashcard-modal"
                data-toggle="modal" matTooltip="Edit flaschcard">
            <mat-icon>edit</mat-icon>
          </span>
          <span (click)="flashcardClicked(flashcard, false)" class="close" data-target=".move-flashcard-modal"
                data-toggle="modal" matTooltip="Move or copy to another deck">
            <mat-icon>move_to_inbox</mat-icon>
          </span>
          <span (click)="flashcardClicked(flashcard, true)" class="close" data-target=".delete-flashcard-modal"
                data-toggle="modal" matTooltip="Remove flashcard">
            <mat-icon>delete</mat-icon>
          </span>
        </div>
      </div>
    </div>


    <!--Edit a deck-->
    <div aria-hidden="true" aria-labelledby="Edit deck modal" class="modal fade edit-deck-modal" role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Edit deck {{this.selectedDeck.name}}</h2>
          </div>
          <div class="modal-body">
            <form class="modal-input-form text-center border border-light p-5">

              <mat-form-field [formGroup]="deckForm" appearance="outline" class="modal-input-full-width">
                <mat-label class="modal-label">New deck title</mat-label>
                <input formControlName="title" formGroupName="title"
                       id="editDeckTitle" matInput
                       placeholder="Title" required type="text">
                <mat-hint *ngIf="deckForm.controls.title.errors" class="control-label invalid-input-text">
                  Can't be empty!
                </mat-hint>
              </mat-form-field>
            </form>
          </div>
          <div class="modal-footer">
            <button (click)="saveEdits(this.selectedDeck)" [disabled]="deckForm.controls.title.errors"
                    data-dismiss="modal" mat-button mat-dialog-actions
                    type="button">Save
            </button>
            <button data-dismiss="modal" mat-button mat-dialog-actions type="button">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!--Delete a deck-->
    <div aria-hidden="true" aria-labelledby="Delete deck modal" class="modal fade delete-deck-modal" role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Deck {{this.selectedDeck.name}}</h2>
          </div>
          <div class="modal-body">
            <h4>Do you really want to delete deck "{{this.selectedDeck.name}}"? </h4>
            <h4> All flashcard within the deck that don't belong to another deck will be lost. </h4>
          </div>
          <div class="modal-footer">
            <button (click)="deleteDeck(this.selectedDeck.id)" data-dismiss="modal" mat-button mat-dialog-actions
                    type="button">
              Delete
            </button>
            <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--Revise flashcards from a deck-->
    <div aria-hidden="true" aria-labelledby="Revise modal" class="modal fade revise-deck" role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Deck {{this.selectedDeck.name}} revision</h2>
          </div>
          <div class="modal-body border border-light p-5">

            <form *ngIf="this.chooseSize; else reviseBlock" [formGroup]="revisionSizeForm">

              <div class="flex-grid">
                <mat-radio-button (change)="this.chosenOption=1" *ngIf="this.dueDateFlashcards"
                                  [disabled]="this.dueDateFlashcards.length==0"
                                  style="padding-bottom: 15px;" value="1">Revise all cards that are
                  due today: <strong>{{this.dueDateFlashcards.length}}</strong></mat-radio-button>
                <button class="close" matTooltip="Our app is using SM-2 algorithm to schedule flashcard revision."
                        matTooltipPosition="above"
                        style="margin: -15px 0px 0px 10px;">
                  <mat-icon>help</mat-icon>
                </button>
              </div>
              <div class="flex-grid">
                <mat-radio-button (change)="this.chosenOption=2" style="padding-top: 10px; padding-right: 5px;"
                                  value="2">Choose a different number of flashcards
                  for revision:
                </mat-radio-button>
                <input class="form-control mb-4" formControlName="revisionSize" max="{{this.selectedDeck.size}}" min="0"
                       style="width:15%;" type="number">
              </div>
            </form>
            <h5 *ngIf="this.sizeError" class="text-warning">Number of chosen cards not corresponding to the size of
              the deck or 0!</h5>
            <h5 *ngIf="this.optionError" class="text-warning">You must choose an option!</h5>

            <ng-template #reviseBlock>
              <div *ngIf="this.currentlyRevisedCard">
                <h4 style="text-align:center">Flashcard <strong>{{this.revisionCounter}}/{{this.revisionFlashcards.length}}</strong>
                </h4>
                <mat-card class="flashcard">
                  <h4> Q: {{this.currentlyRevisedCard.question}}</h4>
                </mat-card>
                <mat-card *ngIf="this.showAnswer" class="flashcard-answer">
                  <h4>A: {{this.currentlyRevisedCard.answer}}</h4>
                </mat-card>
                <div class="flex-container-space-between">

                  <span (click)="this.showAnswer=true" *ngIf="!this.showAnswer" class="close" matTooltip="Show answer">
                   <mat-icon>visibility</mat-icon>
                  </span>
                  <span (click)="this.showAnswer=false" *ngIf="this.showAnswer" class="close" matTooltip="Hide answer">
                   <mat-icon>visibility_off</mat-icon>
                  </span>
                  <span (click)="getRevisionFlashcard();" *ngIf="this.revisionCounter<this.revisionFlashcards.length"
                        class="close" matTooltip="Next flashcard">
                   <mat-icon>arrow_forward_ios</mat-icon>
                  </span>

                </div>
              </div>
            </ng-template>
          </div>
          <div class="modal-footer">
            <button (click)="revise()" [hidden]="!this.chooseSize" mat-button mat-dialog-actions type="button">
              Revise
            </button>
            <button (click)="this.chooseSize=true;" data-dismiss="modal" mat-button mat-dialog-actions type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--Edit a flashcard-->
    <div *ngIf="this.selectedFlashcard" aria-hidden="true" aria-labelledby="Edit flashcard modal"
         class="modal fade edit-flashcard-modal"
         role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Edit a flashcard</h2>
          </div>
          <div class="modal-body flashcardModalBody">
            <form class="modal-input-form text-center border border-light p-5">

              <!-- Question -->
              <mat-form-field [formGroup]="flashcardForm" appearance="outline" class="modal-input-full-width">
                <mat-label class="modal-label">Edit question</mat-label>
                <input formControlName="question" formGroupName="question"
                       id="editQuestion" matInput
                       placeholder="Your question" required type="text">
                <mat-hint *ngIf="flashcardForm.controls.question.errors" class="control-label invalid-input-text">
                  Can't be empty!
                </mat-hint>
              </mat-form-field>

              <!--Answer-->
              <mat-form-field [formGroup]="flashcardForm" appearance="outline" class="modal-input-full-width">
                <mat-label class="modal-label">Edit answer</mat-label>
                <textarea formControlName="answer" formGroupName="answer"
                          id="editAnswer" matInput
                          placeholder="Your answer" required title="Answer"></textarea>
                <mat-hint *ngIf="flashcardForm.controls.answer.errors" class="control-label invalid-input-text">
                  Can't be empty!
                </mat-hint>
              </mat-form-field>
            </form>
          </div>
          <div class="modal-footer">
            <button (click)="saveFlashcardEdits(this.selectedFlashcard)"
                    [disabled]="flashcardForm.controls.question.errors || flashcardForm.controls.answer.errors"
                    data-dismiss="modal" mat-button
                    mat-dialog-actions type="button">
              Save
            </button>
            <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>


    <!--Delete a flashcard-->
    <div *ngIf="this.deleteFlash" aria-hidden="true" aria-labelledby="Delete flashcard modal"
         class="modal fade delete-flashcard-modal"
         role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Flashcard "{{this.selectedFlashcard.question}}"</h2>
          </div>
          <div class="modal-body">
            <h4>Do you really want to remove this flashcard from the deck? </h4>
          </div>
          <div class="modal-footer">
            <button (click)="deleteFlashcard(this.selectedFlashcard.id, this.selectedDeck.id)" data-dismiss="modal"
                    mat-button
                    mat-dialog-actions type="button">
              Delete
            </button>
            <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--Rate a flashcard-->
    <div aria-hidden="true" aria-labelledby="Rate flashcard modal" class="modal fade rate-flashcard-modal"
         role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Rate a flashcard</h2>
          </div>
          <div class="modal-body">
            <form class="border border-light p-5">
              <ngb-rating [(rate)]="currentRate" [max]="5" [readonly]="false"></ngb-rating>
              <h4>Rate personal confidence level from 1 to 5 by choosing the appropriate number of stars!</h4>
            </form>
          </div>
          <div class="modal-footer">
            <button (click)="rateFlashcard(this.selectedFlashcard, currentRate)" data-dismiss="modal" mat-button
                    mat-dialog-actions
                    type="button">
              Rate
            </button>
            <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--Delete a flashcard-->
    <div *ngIf="this.selectedFlashcard" aria-hidden="true" aria-labelledby="Move/copy flashcard modal"
         class="modal fade move-flashcard-modal"
         role="dialog"
         tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Flashcard "{{this.selectedFlashcard.question}}"</h2>
          </div>
          <div class="modal-body">

            <mat-form-field appearance="outline" class="mat-select">
              <mat-label>Select a deck</mat-label>
              <mat-select [(value)]="this.selectedDecksIds" class="select" multiple>
                <mat-option (onSelectionChange)="updateDeckList($event.source.value)" *ngFor="let deck of getDecks()"
                            value="{{deck.id}}">
                  {{deck.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>

          </div>
          <div class="modal-footer">
            <button data-dismiss="modal"
                    mat-button
                    mat-dialog-actions type="button">
              Move
            </button>
            <button data-dismiss="modal"
                    mat-button
                    mat-dialog-actions type="button">
              Copy
            </button>
            <button data-dismiss="modal" mat-button mat-dialog-actions type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>


  </ng-template>
</div>
